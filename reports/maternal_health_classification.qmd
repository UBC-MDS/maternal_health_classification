---
title: Classification Model for identifying Maternal Health Risk
format: 
    html:
        toc: true
        toc-depth: 2
    pdf:
        toc: true
        toc-depth: 2
editor: source
bibliography: references.bib
execute:
    echo: false
    warning: false
---


Shannon Pflueger, Nelli Hovhannisyan, Joseph Lim

# Summary 

# Introduction

Maternal health remains a critical issue worldwide, especially in rural regions and among lower-middle-class families in emerging countries. The lack of access to proper healthcare, inadequate information about maternal care, and insufficient monitoring during pregnancy contribute to high maternal mortality rates. The significance of timely interventions and constant monitoring during pregnancy cannot be overstated, as each moment is crucial to ensuring the health and safety of both the mother and the baby.
This report investigates maternal health risks using exploratory data analysis and classification techniques such as Logistic regression, SVC and Naive Bayes to identify key factors that contribute to complications during pregnancy. 

The primary question addressed in this project is: What are the key indicators that predict maternal health risks during pregnancy?

To answer this question, a dataset containing information on various maternal health factors was used. Leading to the goal of the project which is to create a predictive model that can evaluate the risk factors associated with pregnancy.


```{python}
import pandas as pd
import numpy as np
import pandera as pa
import click
import altair as alt
from IPython.display import Markdown, display
from tabulate import tabulate
```
# Methods

## About Data 

This dataset was sourced from the @UCI. It was collected from rural areas of Bangladesh from various hospitals, community clinics, and maternal healthcare centers; each row in this dataset is health data from a pregnant woman from the Pima Indians Diabetes Database @Pima_indians_data. The dataset collects various non-invasive health data with a goal of predicting maternal health risk at the levels high, medium, or low.
Column descriptions: 

- Age: Age in years when a woman is pregnant.
- SystolicBP: Upper value of Blood Pressure in mmHg, another significant attribute during pregnancy.
- DiastolicBP: Lower value of Blood Pressure in mmHg, another significant attribute during pregnancy.
- BS: Blood glucose levels is in terms of a molar concentration, mmol/L.
- HeartRate: A normal resting heart rate in beats per minute.
- Risk Level: Predicted Risk Intensity Level during pregnancy considering the previous attribute.

## Analysis
To answer our research question we explored several different machine learning models including: Gaussian Bayes, Logistic Regression, Decision Tree, and RBF-SVC, and compared the cross validation results to choose the best one. To accomplish this we used @Python for our analysis, more specifically we used the packages: @numpy, @altair, @pandas, @matplotlib, and @scikit-learn. We are going to drop two rows which contain data that is out of normal range. These two rows both include a heart rate of 7 (beats per minute). This is clearly an error since humans on average have a heart rate between 60-100 bpm @heart_rates. Moreover, heart rate during pregnancy typically increases on average, for various reason, though there is no clear upper limit defined to be normal @pregnancy_tachycardia.
Our dataset has a number of rows that seems to be duplicated, however after some data exploration we have decided to keep these duplicated rows because we believe them to be from different people with the same data. Since there is only 5 columns with whole numbers and one column with an integer to only one decimal point we feel it is likely that multiple people had the same data. Additionally we were able to check the csv file and see that the duplicate rows are far from each other rather than one after another, so we are postulating that they were indeed different individuals who happened to have the same age, blood pressure, body temperature, blood sugar, and risk level.

# Results and Discussion

Let’s begin with a general exploration of our data. Based on the summaries from @tbl-df_describe and @tbl-df_info, we observe that there are no missing values, and all features, except for the target variable, are numeric. 

```{python}
#| label: tbl-df_describe
#| tbl-cap: Description of the maternal risk dataset.

df_describe_table = pd.read_csv("../results/tables/df_describe.csv")
Markdown(df_describe_table.to_markdown(index = False))
```

```{python}
#| label: tbl-df_info
#| tbl-cap: Information of the maternal risk dataset.

df_info_table = pd.read_csv("../results/tables/df_info.csv")
Markdown(df_info_table.to_markdown(index = False))
```

Although the dataset has a relatively small number of observations (@tbl-df_shape), it should still be sufficient for initial modeling efforts.

```{python}
#| label: tbl-df_shape
#| tbl-cap: Shape of the maternal risk dataset.

df_shape_table = pd.read_csv("../results/tables/df_shape.csv")
Markdown(df_shape_table.to_markdown(index = False))
```

From the @fig-countplot_of_risk_level, we can observe that the data is relatively balanced, with the "high risk" category having the fewest observations and the "low risk" category having the most.

![Countplot of the Risk Level variable](../results/figures/countplot_of_risk_level.png){#fig-countplot_of_risk_level width=80%}

Let’s discuss some of the relationships observed in the heatmap of the dataset seen in @fig-heatmap_of_the_maternal_health:

- The “Risk Level,” our target variable, shows a noticeable correlation with “Blood Pressure.” This suggests that individuals with higher or lower blood pressure levels may fall into distinct risk categories. As a result, “Blood Pressure” could be an important predictor in the later stages of our analysis.
- The systolic (upper) and diastolic (lower) blood pressure values exhibit a strong correlation, which is expected since both are closely related physiological metrics. Although we might have considered dropping one of them, the correlation remains below 0.8, so we will retain both, as they may still provide valuable insights when combined with other features.

![Heatmap of the Maternal Health Dataset](../results/figures/heatmap_of_the_maternal_health.png){#fig-heatmap_of_the_maternal_health width=70%}

We can see from the boxplots (@fig-boxplot_by_risk_level) that women in the high-risk group generally have higher values across all our features. For example, older women are more likely to be classified as high risk. Additionally, the high-risk group shows a wider range for upper blood pressure and blood glucose levels, with the median value being slightly higher than that of the other groups.
Another observation here is that there are quite a lot of outliers for the low risk category.

![Boxplot of the Maternal Health Dataset](../results/figures/boxplot_by_risk_level.png){#fig-boxplot_by_risk_level height=60% width=70%}

## Model Comparison

In choosing a classifier model we tried several including: Gaussian Bayes, Logistic Regression, Decision Tree, RBF-SVC. We also included a Dummy Classifier to compare our model to. In {tbl-???} you can see that the Gaussian Bayes scored the lowest, with a validation score of ___. Next was the Logistic Regression model with a validation score of ___, close behind was the RBF-SVM model with a validation score of ___. And finally, the best performing model was the Decision Tree Classifier with a validation score of ___. After choosing the Decision Tree as our model we performed hyperparamter tuning with RandomSearchCV to choose the best max depth, and the split criterion. From this search we found the best validation score with a max depth of ___, and the split criterion 'gini'. 

```{python}
#random_search.score(X_test, y_test)
```

## Reporting Test Score
After finding the best hyperparameters for the Decision Tree, we moved on to scoring our model using the testing data to ascertain how well the Decision Tree performs on unseen data.
Based on the scoring of Decision Tree model on the test data, the model has an accuracy of ___ which is fairly high, but still leaves room for improvement.

In order to answer our primary research question we have identified the first few leaves of our Decision Tree model. Analyzing all levels of the tree is overwhelming and may not provide actionable insights. Focusing only on the top levels should provide us a rough understanding of the most impactful variables that our model has identified. Based on the first three levels of the decision tree, the root node of your tree splits on Blood Sugar (BS) with a threshold of 7.95. This indicates that BS is the most important variable in predicting the maternal health risk classification, as it is the first and most influential split in the tree. The next key split (on the left branch of the tree) is SystolicBP (Systolic Blood Pressure) with a threshold of 132.5, suggesting it is the second-most important variable. On the right subtree, the next key split is SystolicBP (Systolic Blood Pressure) with a threshold of 135.0, is also used to refine classifications, particularly for high-risk predictions. Blood Sugar (BS) stands out as the key indicator for maternal health classification since it governs the initial split and directs subsequent branching based on its values.



# References


